#----------------------------------------------------------------------------#

# Purpose:     Master Execution Script - Stage 1
# Project:     Sales_Tool
# Author:      Clara Marquardt
# Date:        Jan 2017
# Language:    Shell (.sh)

#----------------------------------------------------------------------------#

# Settings
#----------------------------------------------------------------------------#
source helper/setting/setting.sh

#----------------------------------------------------------------------------#
#                         Step-by-Step Tool Execution                        #
#----------------------------------------------------------------------------#

#----------------------------------------------------------------------------#
#----------------------------------------------------------------------------#
# Execution Commmand #1
#----------------------------------------------------------------------------#
#----------------------------------------------------------------------------#

# Stage-a: Extract relevant PDFs from emails
#----------------------------------------------------------------------------#

# execute
#---------------------------------------------------#
cd ${wd_path_code}/stage_a
${php_path}/php  email_extract.php

# Stage-b: Split PDFs
#----------------------------------------------------------------------------#

# execute
#---------------------------------------------------#
cd ${wd_path_code}/stage_b

python order_parse.py "${data_path_parsed}" \
	"${data_path_structured}" "${error_path_parsed}" "${data_path_archived_parsed}" \
	"${wd_path_log}" "${execution_id}" &

cd "${data_path_structured}"

for file in *; do

	# extract 
	pdftotext -layout "${file}" 

done

# execute
#---------------------------------------------------#
cd ${data_path_structured}

R CMD BATCH "--args ${data_path_structured} ${vb_path_input} ${helper_path_keyword} \
	${execution_id}  ${wd_path_log} ${data_path_temp} ${data_path_archived_structured}" order_clean.R


#----------------------------------------------------------------------------#
#----------------------------------------------------------------------------#
# Visual Basic Macro (Input: Csv Output: Xlsx)
#----------------------------------------------------------------------------#
#----------------------------------------------------------------------------#

#----------------------------------------------------------------------------#
#                                    End                                     #
#----------------------------------------------------------------------------#

